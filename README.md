# ExtensionsHelloWorld

:rotating_light: :construction: **IT'S STILL A WORK IN PROGRESS** :construction: :rotating_light:

An example of a [Twitch Extension](https://dev.twitch.tv/docs/extensions/) written in Elixir.

The original source code is accessible here [Extensions-Hello-World](https://github.com/twitchdev/extensions-hello-world).

_Disclaimer_

> This example cover several topics regarding Clean Code, Clean Architecture, Crafted Design and Test-Driven Development. There are also [different points that are left deliberately open](issue page), which you can use to reflect and practice more. The code here is intented for an audience who wants to learn more about Clean Code and/or is looking for a new didactical content.

## Setup

```
mix deps.get
```

## Tests

```
mix test
```

## Integration Tests

Remember to the needed environment variables:

- `JWT_TOKEN_AUTHENTICATOR_SECRET` is the Twitch Extension Secret
- `TWITCH_API_PUBLISHER_CLIENT_ID` is the Twitch Client ID
- `TWITCH_API_PUBLISHER_OWNER_ID`  is the Twitch Owner ID

```
export JWT_TOKEN_AUTHENTICATOR_SECRET=<TWITCH EXTENSION SECRET>
export TWITCH_API_PUBLISHER_CLIENT_ID=<TWITCH EXTENSION CLIENT ID>
export TWITCH_API_PUBLISHER_OWNER_ID=<TWITCH OWNER ID>
```

The run the integration tests

```
mix test --only integration
```

## Start the application

Remember to the needed environment variables:

- `JWT_TOKEN_AUTHENTICATOR_SECRET` is the Twitch Extension Secret
- `TWITCH_API_PUBLISHER_CLIENT_ID` is the Twitch Client ID
- `TWITCH_API_PUBLISHER_OWNER_ID`  is the Twitch Owner ID

```
export JWT_TOKEN_AUTHENTICATOR_SECRET=<TWITCH EXTENSION SECRET>
export TWITCH_API_PUBLISHER_CLIENT_ID=<TWITCH EXTENSION CLIENT ID>
export TWITCH_API_PUBLISHER_OWNER_ID=<TWITCH OWNER ID>
```

Start

```
mix run --no-halt
```

The server will listen at port `4001`

Make a test call:

```
curl -v -X POST -H "Authorization: Bearer <JWT_TOKEN>" http://localhost:4001/color/cycle
```

The `<JWT_TOKEN>` is generated by the client and contains the information about `channel_id` and `user_id`

## F.A.Q. on Twitch API

**Q. How can I get my `Twitch Owner Id` ?**

A. Make a call to Twitch:

```
curl -H "Client-ID: <TWITCH EXTENSION CLIENT ID>" -X GET "https://api.twitch.tv/helix/users?login=<YOUR CHANNEL NAME>"
```

You will get a response like that:

```
{
  "data": [
    {
      "id": <TWITCH OWNER ID>, <--- Bingo!
      "login": "YOUR CHANNEL NAME",
      "display_name": "YOUR DISPLAY NAME",
      "type": "",
      ...
    }
  ]
}
```